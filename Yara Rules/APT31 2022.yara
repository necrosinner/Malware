rule Chinese
{
	strings:
/* Loading Crypt32
C6 40 10 43                   mov     byte ptr [rax+10h], 43h ; 'C'
C6 40 11 72                   mov     byte ptr [rax+11h], 72h ; 'r'
C6 40 12 79                   mov     byte ptr [rax+12h], 79h ; 'y'
C6 40 13 70                   mov     byte ptr [rax+13h], 70h ; 'p'
C6 40 14 74                   mov     byte ptr [rax+14h], 74h ; 't'
44 88 68 17                   mov     [rax+17h], r13b
C6 40 15 33                   mov     byte ptr [rax+15h], 33h ; '3'
C6 40 16 32                   mov     byte ptr [rax+16h], 32h ; '2' */
		$Crypt1 = {C6 ?? ?? 43} 
		$Crypt2 = {C6 ?? ?? 72}
		$Crypt3 = {C6 ?? ?? 79} 
		$Crypt4 = {C6 ?? ?? 70}
		$Crypt5 = {C6 ?? ?? 74}
		$Crypt6 = {C6 ?? ?? 33}
		$Crypt7 = {C6 ?? ?? 32}
/*
Check for API Hashes
81 F9 8A 6F C6 13                             cmp     ecx, 13C66F8Ah
0F 84 95 00 00 00                             jz      L1
81 F9 F9 1D 7F A9                             cmp     ecx, 0A97F1DF9h
74 7C                                         jz      L2
81 F9 8A 5A 63 AB                             cmp     ecx, 0AB635A8Ah
74 63                                         jz      L3
81 F9 AA 6B 00 D1                             cmp     ecx, 0D1006BAAh
74 4A                                         jz      L4
81 F9 A5 B5 C0 D8                             cmp     ecx, 0D8C0B5A5h
74 31                                         jz      L5
81 F9 C1 77 4A E7                             cmp     ecx, 0E74A77C1h
74 19                                         jz      L6
81 F9 50 F8 71 FC                             cmp     ecx, 0FC71F850h
75 74                                         jnz     L7		*/
		$Hash1 = {8a 6f c6 13}
		$Hash2 = {f9 1d 7f a9}
		$Hash3 = {8a 5a 63 ab}
		$Hash4 = {aa 6b 00 d1}
		$Hash5 = {a5 b5 c0 d8}
		$Hash6 = {c1 77 4a e7}
		$Hash7 = {50 f8 71 fc}
/* API Hashing Algorithm
                              loc_18000346F:
C1 C9 0E                      ror     ecx, 0Eh
0F BE C0                      movsx   eax, al
49 FF C0                      inc     r8
03 C8                         add     ecx, eax
41 8A 00                      mov     al, [r8]
84 C0                         test    al, al
75 EE                         jnz     short loc_18000346F
*/
		$Alg = {C1 ?? 0E 0F BE ?? 49 FF [6] 84 ?? 75}
	condition: 
		(uint16(0) == 0x5A4D) and (uint32(uint32(0x3C)) == 0x00004550) and
		(all of ($Hash*) or $Alg) and (5 of ($Crypt*))
}

rule Contains_Known_Chinese_Path
{
	strings:
			$path = "C:\\ProgramData\\Microsoft\\Settings\\Desktop.ini"
	condition:
			$path
}
