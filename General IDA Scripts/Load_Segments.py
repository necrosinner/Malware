import os
import ida_segment
import ida_loader
import idc

# Base address for the new segment
BASE = 0x0

# Ensure offsets you want loaded are also the extention name. EG: unknown.0077FF55
# Function to load files into segments
def load_files(dirname):
    for filename in os.listdir(dirname):
        ext = os.path.splitext(filename)[1]
        if ext in {'.id0', '.id1', '.id2', '.nam', '.til'}:
            continue  # Skip files with excluded extensions
        offset = int(ext[1:], 16)
        segname = f"{filename}_{hex(offset)}"
        segstart = BASE + offset
        segend = segstart + os.path.getsize(os.path.join(dirname, filename))
        ida_segment.add_segm(0, segstart, segend, str(hex(segstart)), "DATA")

# Get the directory containing the current IDB file
dirname = os.path.dirname(ida_nalt.get_input_file_path())

# Load all files in the directory into segments
load_files(dirname)
